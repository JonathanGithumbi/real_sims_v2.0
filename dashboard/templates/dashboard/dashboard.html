{% extends './layout.html' %}
{% load static %}


{% block content_area %}
<h1>Dashboard</h1>
<hr>

{% if status == "connected" %}
Quickbooks Connected Successfully !
<div>
    {% if openid %}
        <button onclick="userInfoCall()">UserInfo API Call</button>
    {% else %}
        <button onclick="apiCall()">QuickBooks API Call</button>
    {% endif %}
    <button onclick="refreshCall()">Refresh Token Call</button>
    <button onclick="revokeCall()">Revoke Token Call</button>
    
    <br><br>
    <div><code id="result"></code></div>
</div>
{% endif %}
{% if status == "disconnected" %}
Quickbooks disconnected
<br>
<a class="imgLink"
         href="#"
         onclick="launchPopup('/user_account/oauth/')">
        <img style="height: 40px"
             src="{% static 'C2QB_white_btn_lg_default.png' %}"/>
      </a>
{% endif %}
<script>
    if (window.opener) {
        window.opener.location.href = '/dashboard/'
        window.close()
    }

    function launchPopup(path) {
        var win;
        var checkConnect;
        var parameters = "location=1,width=800,height=650";
        parameters += ",left=" + (screen.width - 800) / 2 + ",top=" + (screen.height - 650) / 2;

        // Launch Popup
        win = window.open(path, 'connectPopup', parameters);
    }

    function migrateCall() {
        $("#result").html('Loading...')
        $.get("/user_account/migration", function (data) {
            $("#result").html(JSON.stringify(data, null, 2))
        })
    }
  </script>
<script>
    if (window.opener) {
        window.opener.location.href = '/user_account/connected'
        window.close()
    }
 </script>
 <script>
    function apiCall() {
        $("#result").html('Loading...')
        $.get("/user_account/qbo_request", function (data) {
            $("#result").html(data)
        })
    }

    function revokeCall() {
        $("#result").html('Loading...')
        $.get("/user_account/revoke", function (data) {
            $("#result").html(data)
        })
    }

    function refreshCall() {
        $("#result").html('Loading...')
        $.get("/user_account/refresh", function (data) {
            $("#result").html(JSON.stringify(data, null, 2))
        })
    }

    function userInfoCall() {
        $("#result").html('Loading...')
        $.get("/user_account/user_info", function (data) {
            $("#result").html(data)
        })
    }
</script>
{% endblock content_area %}