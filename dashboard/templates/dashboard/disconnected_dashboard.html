{% extends 'dashboard/layout.html' %}
{% load static %}
{% block content_area %}
{% if messages %}
<ul class="messages">
    {% for message in messages %}
        <div class="alert alert-success alert-dismissible">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            {{message}}
          </div>+
    {% endfor %}
</ul>
{% endif %}
    <div id="loggedIn" />
    <h3>Welcome to the Intuit OAuth2 Sample App!</h3>
    Before using this app, please make sure you do the following:
    <ul>
        <li>
            Update settings.py with your Client ID and Client Secret (found on
            <a href="https://developer.intuit.com">developer.intuit.com</a>
            )
        </li>
        <li>
            In <a href="https://developer.intuit.com">developer.intuit.com</a>,
            add an allowed Redirect URI to this sample app! (settings.py value: REDIRECT_URI)
        </li>
    </ul>
    <br/>
    <br/>
    <br/>
    <b>OAuth2 flow</b>
    <br/>
    <a class="imgLink" href="#" onclick="launchPopup('/user_account/oauth/')">
        <img style="height: 40px"
             src="{% static 'C2QB_white_btn_lg_default.png' %}"/>
    </a>
    <br/>
    <br/>
    <br/>
    <b>Migration API</b>
    <br/>
    <button onclick="migrateCall()">Migration API call</button>
    <br />
    <div>
        <code id="result"></code>
    </div>
    <script>
    if (window.opener) {
        window.opener.location.href = '/dashboard/disconnected/'
        window.close()
    }

    function launchPopup(path) {
        var win;
        var checkConnect;
        var parameters = "location=1,width=800,height=650";
        parameters += ",left=" + (screen.width - 800) / 2 + ",top=" + (screen.height - 650) / 2;

        // Launch Popup
        win = window.open(path, 'connectPopup', parameters);
    }

    function migrateCall() {
        $("#result").html('Loading...')
        $.get("/app/migration", function (data) {
            $("#result").html(JSON.stringify(data, null, 2))
        })
    }
    </script>
{% endblock content_area %}
