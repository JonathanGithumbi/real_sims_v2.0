{% extends 'layout.html' %}
{% load static %}
{% block page %}
  <!-- Begin Page Content -->
  <div class="container-fluid">
    <br/>
    <div class="card shadow mb-4">
      <div class="card-header py-3">
        <h5 class="m-0 font-weight-bold">Vendors</h5>
        <hr />
        <!--Modal-->
        {% include "_modal.html" %}
        <!-- Create vendor button -->
        <button id="create-vendor"
                class="btn btn-primary btn-sm"
                type="button"
                name="button">Create Vendor</button>
      </div>
      <!--Table Body-->
      <div class="card-body">
        <div class="table-responsive">{% include "_vendors_table.html" %}</div>
      </div>
    </div>
  </div>
  <!-- /.container-fluid -->
  {% block script %}
    <script type="text/javascript">
      $(function () {
          
          // Create vendor asynchronous button
          // message
          var asyncSuccessMessageCreate = [
            "<div ", "style='position:fixed;top:0;z-index:10000;width:100%;border-radius:0;' ", "class='alert alert-icon alert-success alert-dismissible fade show mb-0' role='alert'>",
            "Success: Vendor was created.",
            "<button type='button' class='close' data-dismiss='alert' aria-label='Close'>",
            "<span aria-hidden='true'>&times;</span>",
            "</button>",
            "</div>",
            "<script>",
            "$('.alert').fadeTo(2000, 500).slideUp(500, function () {$('.alert').slideUp(500).remove();});",
            "<\/script>"
          ].join("");

          // modal form
          function createVendorAsyncModalForm() {
            $("#create-vendor").modalForm({
                formURL: "{% url 'create_vendor' %}",
                modalID: "#create-modal",
                asyncUpdate: true,
                asyncSettings: {
                  closeOnSubmit: true,
                  successMessage: asyncSuccessMessageCreate,
                  dataUrl: "vendors/",
                  dataElementId: "#vendors-table",
                  dataKey: "table",
                  addModalFormFunction: reinstantiateModalForms
                }
            });
          }
          createVendorAsyncModalForm();

          // Update vendor asynchronous button
          // message
          var asyncSuccessMessageUpdate = [
            "<div ", "style='position:fixed;top:0;z-index:10000;width:100%;border-radius:0;' ", "class='alert alert-icon alert-success alert-dismissible fade show mb-0' role='alert'>",
            "Success: Vendor was updated.",
            "<button type='button' class='close' data-dismiss='alert' aria-label='Close'>",
            "<span aria-hidden='true'>&times;</span>",
            "</button>",
            "</div>",
            "<script>",
            "$('.alert').fadeTo(2000, 500).slideUp(500, function () {$('.alert').slideUp(500).remove();});",
            "<\/script>"
          ].join("");

          // modal form
          function updateVendorModalForm() {
            $(".update-vendor").each(function () {
              $(this).modalForm({
                formURL: $(this).data("form-url"),
                asyncUpdate: true,
                asyncSettings: {
                  closeOnSubmit: true,
                  successMessage: asyncSuccessMessageUpdate,
                  dataUrl: "{% url 'vendors'%}",
                  dataElementId: "#vendors-table",
                  dataKey: "table",
                  addModalFormFunction: reinstantiateModalForms
                }
              });
            });
          }
          updateVendorModalForm();

          // Delete vendor buttons - formURL is retrieved from the data of the element
          function deleteVendorModalForm() {
            $(".delete-vendor").each(function () {
                $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: true});
            });
          }
          deleteVendorModalForm();

          // Read vendor buttons
          function readVendorModalForm() {
            $(".read-vendor").each(function () {
                $(this).modalForm({formURL: $(this).data("form-url")});
            });
          }
          readVendorModalForm();

          function reinstantiateModalForms() {
            createVendorAsyncModalForm();
            readVendorModalForm();
            updateVendorModalForm();
            deleteVendorModalForm();
          }

         

          // Hide message
          $(".alert").fadeTo(2000, 500).slideUp(500, function () {
              $(".alert").slideUp(500);
          });


          //Vendors DataTable Configuration
          var table = $('#vendors-table').DataTable({
          fixedHeader: true,
          order: [[1, 'asc']],
          dom: 'Bfrtip',
          lengthMenu: [
          10, 25, 50, -1
          ],
          buttons: [
          {
              extend: 'pdf',
              
              download:'open',
              title: "Vendors List",
              messageBottom: function(){
                  var curr_date = new Date();
                  txt_curr_date = curr_date.toString();
                  return txt_curr_date+"\n ~School Information Management System~";
              },
              exportOptions: {
                      columns: ':visible'
                  }
          },
          'pageLength',
          'colvis'
          ],
          columnDefs: [{
          orderable: false,
          
          targets: 0
          }],
          
          });     
    //Add Styling to the buttons
    table.buttons().container().appendTo('#example_wrapper .col-md-6:eq(0)')

      });
</script>
{% endblock script %}
{% endblock %}
